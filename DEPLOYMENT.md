# ğŸ“š StudyMate API ë°°í¬ ê°€ì´ë“œ

## ğŸš€ AWS EC2 ë¬´ì¤‘ë‹¨ ë°°í¬ ì‹œìŠ¤í…œ

### ğŸ“‹ ëª©ì°¨
- [ì•„í‚¤í…ì²˜ ê°œìš”](#-ì•„í‚¤í…ì²˜-ê°œìš”)
- [ì´ˆê¸° ì„¤ì •](#-ì´ˆê¸°-ì„¤ì •)
- [CI/CD íŒŒì´í”„ë¼ì¸](#-cicd-íŒŒì´í”„ë¼ì¸)
- [ë°°í¬ í”„ë¡œì„¸ìŠ¤](#-ë°°í¬-í”„ë¡œì„¸ìŠ¤)
- [ëª¨ë‹ˆí„°ë§ ë° ë¡¤ë°±](#-ëª¨ë‹ˆí„°ë§-ë°-ë¡¤ë°±)
- [ë¹„ìš© ìµœì í™”](#-ë¹„ìš©-ìµœì í™”)

---

## ğŸ— ì•„í‚¤í…ì²˜ ê°œìš”

### ì‹œìŠ¤í…œ êµ¬ì„± (AWS í”„ë¦¬í‹°ì–´ ìµœì í™”)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   GitHub Repository                  â”‚
â”‚                  (StudyMate-API)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Push to main branch
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              GitHub Actions CI/CD                    â”‚
â”‚         â€¢ Test â†’ Build â†’ Deploy â†’ Health Check       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ SSH Deploy
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  AWS EC2 Instance                    â”‚
â”‚                   (t2.micro - í”„ë¦¬í‹°ì–´)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚               Nginx (Port 80)                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚               â”‚          â”‚                           â”‚
â”‚         Blue â”‚          â”‚ Green                      â”‚
â”‚         Port 8000      Port 8001                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   Gunicorn   â”‚  â”‚   Gunicorn   â”‚                â”‚
â”‚  â”‚   (tmux)     â”‚  â”‚   (tmux)     â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚         â”‚                â”‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚    Django Application          â”‚                â”‚
â”‚  â”‚    + Redis (ë¡œì»¬)               â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AWS RDS (t3.micro)                      â”‚
â”‚              PostgreSQL Database                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ ì´ˆê¸° ì„¤ì •

### 1. EC2 ì¸ìŠ¤í„´ìŠ¤ ì¤€ë¹„

```bash
# SSHë¡œ EC2 ì ‘ì†
ssh -i /path/to/your-key.pem ec2-user@your-ec2-ip

# ì´ˆê¸° ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
curl -O https://raw.githubusercontent.com/StudyMate-Company/StudyMate-API/main/scripts/setup_ec2.sh
chmod +x setup_ec2.sh
./setup_ec2.sh
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
cd ~/apps/StudyMate-API
cp .env.example .env
nano .env  # ì‹¤ì œ ê°’ìœ¼ë¡œ ìˆ˜ì •
```

### 3. GitHub Secrets ì„¤ì •

GitHub ì €ì¥ì†Œ Settings â†’ Secrets and variables â†’ Actionsì—ì„œ ë‹¤ìŒ ì‹œí¬ë¦¿ ì¶”ê°€:

| Secret Name | Description | Example |
|------------|-------------|---------|
| `EC2_HOST` | EC2 í¼ë¸”ë¦­ IP | `13.125.xxx.xxx` |
| `EC2_PRIVATE_KEY` | EC2 SSH í”„ë¼ì´ë¹— í‚¤ | `-----BEGIN RSA...` |
| `SLACK_WEBHOOK` | Slack ì•Œë¦¼ URL (ì„ íƒ) | `https://hooks.slack...` |

---

## ğŸ”„ CI/CD íŒŒì´í”„ë¼ì¸

### GitHub Actions ì›Œí¬í”Œë¡œìš°

```yaml
# .github/workflows/deploy.yml
name: Deploy to AWS EC2

on:
  push:
    branches: [main]

jobs:
  test:
    # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
  deploy:
    # ë¬´ì¤‘ë‹¨ ë°°í¬
  rollback:
    # ì‹¤íŒ¨ ì‹œ ìë™ ë¡¤ë°±
```

### ë°°í¬ íŠ¸ë¦¬ê±°
- `main` ë¸Œëœì¹˜ì— push ë˜ëŠ” merge
- GitHub Actions í˜ì´ì§€ì—ì„œ ìˆ˜ë™ ì‹¤í–‰

---

## ğŸ“¦ ë°°í¬ í”„ë¡œì„¸ìŠ¤

### Blue-Green ë¬´ì¤‘ë‹¨ ë°°í¬

1. **ì½”ë“œ ì—…ë°ì´íŠ¸**
   ```bash
   git fetch --all
   git reset --hard origin/main
   ```

2. **ì˜ì¡´ì„± ì„¤ì¹˜**
   ```bash
   pip install -r requirements.txt --no-cache-dir
   ```

3. **ë§ˆì´ê·¸ë ˆì´ì…˜**
   ```bash
   python manage.py migrate --noinput
   ```

4. **ì •ì  íŒŒì¼ ìˆ˜ì§‘**
   ```bash
   python manage.py collectstatic --noinput
   ```

5. **ìƒˆ ì¸ìŠ¤í„´ìŠ¤ ì‹œì‘** (Blue ë˜ëŠ” Green)
   ```bash
   tmux new-session -d -s studymate_8001 \
     "gunicorn studymate_api.wsgi:application --bind 127.0.0.1:8001"
   ```

6. **í—¬ìŠ¤ ì²´í¬**
   ```bash
   curl http://127.0.0.1:8001/health/
   ```

7. **Nginx ì „í™˜**
   ```nginx
   upstream studymate_backend {
       server 127.0.0.1:8001;  # Greenìœ¼ë¡œ ì „í™˜
   }
   ```

8. **ì´ì „ ì¸ìŠ¤í„´ìŠ¤ ì¢…ë£Œ**
   ```bash
   tmux kill-session -t studymate_8000
   ```

---

## ğŸ” ëª¨ë‹ˆí„°ë§ ë° ë¡¤ë°±

### tmux ì„¸ì…˜ ê´€ë¦¬

```bash
# ì‹¤í–‰ ì¤‘ì¸ ì„¸ì…˜ í™•ì¸
tmux ls

# ì„¸ì…˜ ì ‘ì†
tmux attach -t studymate_8000

# ì„¸ì…˜ì—ì„œ ë‚˜ê°€ê¸° (ì„¸ì…˜ ìœ ì§€)
Ctrl+B, D

# ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
tail -f ~/apps/logs/error.log
```

### ìˆ˜ë™ ë°°í¬

```bash
cd ~/apps/StudyMate-API
./scripts/deploy.sh
```

### ê¸´ê¸‰ ë¡¤ë°±

```bash
cd ~/apps/StudyMate-API
./scripts/rollback.sh
```

### ìƒíƒœ í™•ì¸

```bash
# í”„ë¡œì„¸ìŠ¤ í™•ì¸
ps aux | grep gunicorn

# í¬íŠ¸ í™•ì¸
sudo netstat -tlnp | grep :800

# Nginx ìƒíƒœ
sudo systemctl status nginx

# Redis ìƒíƒœ
sudo systemctl status redis6
```

---

## ğŸ’° ë¹„ìš© ìµœì í™”

### AWS í”„ë¦¬í‹°ì–´ í™œìš©

| ì„œë¹„ìŠ¤ | í”„ë¦¬í‹°ì–´ ì œí•œ | ì„¤ì • |
|--------|-------------|------|
| EC2 | t2.micro 750ì‹œê°„/ì›” | 1ê°œ ì¸ìŠ¤í„´ìŠ¤ë§Œ ì‹¤í–‰ |
| RDS | t3.micro 750ì‹œê°„/ì›” | ìë™ ë°±ì—… ë¹„í™œì„±í™” |
| S3 | 5GB ìŠ¤í† ë¦¬ì§€ | ì •ì  íŒŒì¼ìš© |
| CloudWatch | ê¸°ë³¸ ë©”íŠ¸ë¦­ ë¬´ë£Œ | ìƒì„¸ ëª¨ë‹ˆí„°ë§ OFF |

### ìµœì í™” íŒ

1. **ë©”ëª¨ë¦¬ ê´€ë¦¬**
   - Gunicorn ì›Œì»¤ ìˆ˜: 2ê°œ
   - max-requests: 1000 (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€)

2. **ìŠ¤í† ë¦¬ì§€ ì ˆì•½**
   - pip install --no-cache-dir
   - ë°±ì—… 3ê°œë§Œ ìœ ì§€
   - ë¡œê·¸ ë¡œí…Œì´ì…˜ ì„¤ì •

3. **ëŒ€ì—­í­ ì ˆì•½**
   - Gzip ì••ì¶• í™œì„±í™”
   - ì •ì  íŒŒì¼ ìºì‹± (30ì¼)
   - CloudFront ì‚¬ìš© ê²€í† 

---

## ğŸ›  íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì¼ë°˜ì ì¸ ë¬¸ì œ í•´ê²°

| ë¬¸ì œ | ì›ì¸ | í•´ê²° ë°©ë²• |
|------|------|----------|
| 502 Bad Gateway | Gunicorn ë¯¸ì‹¤í–‰ | `tmux ls`ë¡œ í™•ì¸ í›„ ì¬ì‹œì‘ |
| ë©”ëª¨ë¦¬ ë¶€ì¡± | ì›Œì»¤ ê³¼ë‹¤ | ì›Œì»¤ ìˆ˜ ê°ì†Œ (2ê°œ) |
| ë””ìŠ¤í¬ ê°€ë“ | ë¡œê·¸ ëˆ„ì  | ë¡œê·¸ ì •ë¦¬: `rm ~/apps/logs/*.log` |
| ë°°í¬ ì‹¤íŒ¨ | ê¶Œí•œ ë¬¸ì œ | `chmod +x scripts/*.sh` |

### ë¡œê·¸ ìœ„ì¹˜

```bash
# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸
~/apps/logs/error.log
~/apps/logs/access.log

# Nginx ë¡œê·¸
/var/log/nginx/error.log
/var/log/nginx/access.log

# ì‹œìŠ¤í…œ ë¡œê·¸
journalctl -u nginx
journalctl -u redis6
```

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°°í¬ ì „
- [ ] ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] requirements.txt ì—…ë°ì´íŠ¸
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±
- [ ] .env ì„¤ì • í™•ì¸

### ë°°í¬ í›„
- [ ] í—¬ìŠ¤ ì²´í¬ í†µê³¼
- [ ] ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
- [ ] ë¡œê·¸ ì—ëŸ¬ í™•ì¸
- [ ] ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

---

## ğŸ†˜ ì§€ì›

### ì—°ë½ì²˜
- ì´ìŠˆ: [GitHub Issues](https://github.com/StudyMate-Company/StudyMate-API/issues)
- ì´ë©”ì¼: devops@studymate.com

### ìœ ìš©í•œ ëª…ë ¹ì–´

```bash
# ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ í™•ì¸
htop

# ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰
df -h

# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
free -m

# ë„¤íŠ¸ì›Œí¬ ì—°ê²°
ss -tulpn

# í”„ë¡œì„¸ìŠ¤ íŠ¸ë¦¬
pstree -p
```

---

## ğŸ” ë³´ì•ˆ ê¶Œì¥ì‚¬í•­

1. **SSH í‚¤ ê´€ë¦¬**
   - í”„ë¼ì´ë¹— í‚¤ëŠ” ì•ˆì „í•˜ê²Œ ë³´ê´€
   - GitHub Secretsì—ë§Œ ì €ì¥

2. **í™˜ê²½ ë³€ìˆ˜**
   - .env íŒŒì¼ì€ ì ˆëŒ€ ì»¤ë°‹í•˜ì§€ ì•ŠìŒ
   - í”„ë¡œë•ì…˜ ì‹œí¬ë¦¿ì€ ë³„ë„ ê´€ë¦¬

3. **ë°©í™”ë²½ ì„¤ì •**
   - í•„ìš”í•œ í¬íŠ¸ë§Œ ì˜¤í”ˆ (80, 443, 22)
   - IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ì„¤ì • ê¶Œì¥

4. **ì •ê¸° ì—…ë°ì´íŠ¸**
   ```bash
   sudo yum update -y
   pip list --outdated
   ```

---

**Last Updated**: 2024ë…„ 12ì›”
**Version**: 1.0.0